name: Daily Stock Update

on:
  schedule:
    # "Cron" syntax: minute hour day_of_month month day_of_week
    # 22:00 UTC on Mon,Tue,Wed,Thu,Fri
    - cron: '0 22 * * 1-5'
  workflow_dispatch:  # Allows you to click "Run workflow" manually button

jobs:
  update-stocks:
    runs-on: ubuntu-latest  # The virtual machine environment

    # Permission to write to the repo (to save the CSVs)
    permissions:
      contents: write

    steps:
    # 1. Download your code
    - name: Checkout repository
      uses: actions/checkout@v3

    # 2. Install Python
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    # 3. Install libraries
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pandas yfinance matplotlib tqdm requests beautifulsoup4 lxml html5lib

    # 4. Run your script
    - name: Run daily download script
      run: python daily_download.py

    # 5. Save the results (Git Commit & Push)
    - name: Commit and push changes
      run: |
        git config --global user.name "GitHub Action"
        git config --global user.email "action@github.com"
        git add stock_data/
        git commit -m "Auto-update stock data" || echo "No changes to commit"
        git push
